# もっと便利に！MultiLogViewer 追加機能ガイド 🌟

このガイドでは、最近追加された「ログをもっと見やすく、分かりやすくする」ための新しい設定について解説します。
基本の書き方に慣れてきたら、これらの機能を組み合わせて「自分専用の最強ログビューアー」を作ってみましょう！

---

## 1. 離ればなれのログをひとつに！ (複数行ログ)

エラーが起きたとき、ログが何行にもわたって出力されることがありますよね。
「1 行目だけ見て、2 行目以降（エラーの詳細など）を見逃してしまった…」なんてことがなくなります。

### 💡 どんな機能？

新しいログが始まる「決まった形」ではない行が来たとき、「これは前のログの続きだ！」と判断して、自動的にひとつにまとめます。

### 📝 書き方

`log_formats` の中に `is_multiline: true` と書くだけです。
※実は、何も書かなくても最初から `true` になっています！

```yaml
log_formats:
  - name: "エラーが出るログ"
    is_multiline: true # 複数行を自動で合体！
    ...
```

---

## 2. 文字を分かりやすく変身させる！ (表示変換)

ログの中にある素っ気ない記号や短い文字を、パッと見て意味がわかるように「お化粧」できます。

### ✨ マッピング (map)

「A という文字が来たら B と表示する」という辞書のような機能です。

- **たとえば**: ログに `E` とあれば `❌ ERROR` 、`W` とあれば `⚠ WARN` と表示する。

### ✨ フォーマット (format)

「文字の前後を飾り付ける」機能です。

- **たとえば**: ユーザー名 `admin` を `👤 ユーザー: admin` のように目立たせる。

### 📝 書き方 (field_transforms)

```yaml
field_transforms:
  - field: "level" # どの項目を変えたい？
    map:
      "I": "ℹ INFO" # I なら ℹ INFO に変える
      "E": "❌ ERROR" # E なら ❌ ERROR に変える
    format: "【{value}】" # さらに隅付き括弧で囲む！
```

**結果**: ログの `E` という文字が、画面では `【❌ ERROR】` と表示されます。

---

## 3. メッセージの中から「お宝情報」を抜き出す (サブパターン)

「長いメッセージの途中に、実はユーザー ID や処理時間が埋まっている」という場合に、そこだけを抜き出して別の列に表示できます。

### 💡 どんな機能？

一度抜き出した「メッセージ」というカタマリの中から、さらに虫眼鏡でのぞくように情報を探します。

### 📝 書き方 (sub_patterns)

```yaml
sub_patterns:
  - source_field: "message" # メッセージの中から探してね
    pattern: "user=(?<user>\\w+)" # user= の後ろにある英数字を「ユーザー」として抜き出す
```

---

## 4. 日付ごとに変わるフォルダに対応！ (動的パス解決)

「毎日新しい日付のフォルダが作られるので、そのたびに設定を変えるのが面倒…」というお悩みを解決します！

### 💡 どんな機能？

ファイルパスの中に `{yyyy}` や `{MM}`, `{dd}` と書くと、実行した瞬間の日付に自動的に置き換わります。
Tail 機能（リアルタイム監視）を使っていれば、**日付が変わった瞬間に新しいフォルダのログを自動で見つけて読み込みを開始**します。

### 📝 書き方

`log_file_patterns` の中で、以下のキーワードが使えます。

- `{yyyy}` : 西暦 4 桁 (例: 2023)
- `{MM}` : 月 (例: 12)
- `{dd}` : 日 (例: 21)
- `{HH}` : 時
- `{mm}` : 分

```yaml
log_formats:
  - name: "日付フォルダログ"
    log_file_patterns:
      # C:\Logs\2023\12\21\app.log のように自動で解釈されます
      - "C:\\Logs\\{yyyy}\\{MM}\\{dd}\\app.log"
      # glob パターンとの組み合わせも OK！
      - "logs/{yyyy}{MM}{dd}/*.log"
```

---

## 5. よく使うフィルタを保存！ (フィルタ・プリセット)

「エラー調査のたびに同じフィルタを設定するのが面倒…」という時に便利な機能です。

### 💡 どんな機能？

現在の検索キーワードと拡張フィルターの状態を、ひとつの YAML ファイルとして保存できます。
読み込むときは、現在のログに存在する項目（キー）だけが自動的に復元されるため、異なる種類のログ間でも安心して使えます。

### 📝 使い方

1. **保存**: フィルタボックスの左側にある「漏斗（じょうご）」アイコンを右クリック、またはクリックして「フィルターを保存...」を選択します。
2. **読み込み**: 同じくアイコンのメニューから「フィルターを読み込む...」を選択し、保存したファイルを選びます。

---

## 🚀 全部使った「劇的ビフォーアフター」例

こんな不親切なログも、設定次第でここまで変わります！

**元のログ (Before):**
`2023-12-20 [E] 処理失敗 user=tanaka`
`   at System.Main()` (← 複数行)

**設定 (config.yaml):**

```yaml
log_formats:
  - name: "デモログ"
    is_multiline: true # 複数行をまとめる
    field_transforms:
      - field: "level"
        map: { "E": "❌ エラー発生" } # E を分かりやすく
    sub_patterns:
      - source_field: "message"
        pattern: "user=(?<user>\\w+)"
        field_transforms:
          - field: "user"
            format: "担当者：{value}" # 担当者：を付ける
```

**画面での見え方 (After):**
| 日時 | レベル | メッセージ | ユーザー |
| :--- | :--- | :--- | :--- |
| 2023/12/20 | ❌ エラー発生 | 処理失敗 user=tanaka | 担当者：tanaka |

さらに、右側の「詳細パネル」を開けば、合体した `at System.Main()` もしっかり確認できます！

---

## 💡 知っておくと得するコツ

- **名前（field）を合わせる**: `(?<level>...)` で抜き出した名前と、`field: "level"` の名前をぴったり同じにするのがコツです。
- **絵文字を使おう**: `map` の中に絵文字を入れると、文字を読まなくても状況がわかるようになるのでオススメです！

新しい機能を活用して、ログ調査を楽しくしましょう！🌱
